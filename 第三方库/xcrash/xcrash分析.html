<!DOCTYPE html><html><head>
      <title>xcrash&#x5206;&#x6790;</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:////Users/yxhuang/.vscode/extensions/shd101wyy.markdown-preview-enhanced-0.6.1/node_modules/@shd101wyy/mume/dependencies/katex/katex.min.css">
      
      
      
      
      
      
      
      
      
      <style>
      /**
 * prism.js Github theme based on GitHub's theme.
 * @author Sam Clarke
 */
code[class*="language-"],
pre[class*="language-"] {
  color: #333;
  background: none;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.4;

  -moz-tab-size: 8;
  -o-tab-size: 8;
  tab-size: 8;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
  padding: .8em;
  overflow: auto;
  /* border: 1px solid #ddd; */
  border-radius: 3px;
  /* background: #fff; */
  background: #f5f5f5;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
  white-space: normal;
  background: #f5f5f5;
}

.token.comment,
.token.blockquote {
  color: #969896;
}

.token.cdata {
  color: #183691;
}

.token.doctype,
.token.punctuation,
.token.variable,
.token.macro.property {
  color: #333;
}

.token.operator,
.token.important,
.token.keyword,
.token.rule,
.token.builtin {
  color: #a71d5d;
}

.token.string,
.token.url,
.token.regex,
.token.attr-value {
  color: #183691;
}

.token.property,
.token.number,
.token.boolean,
.token.entity,
.token.atrule,
.token.constant,
.token.symbol,
.token.command,
.token.code {
  color: #0086b3;
}

.token.tag,
.token.selector,
.token.prolog {
  color: #63a35c;
}

.token.function,
.token.namespace,
.token.pseudo-element,
.token.class,
.token.class-name,
.token.pseudo-class,
.token.id,
.token.url-reference .token.variable,
.token.attr-name {
  color: #795da3;
}

.token.entity {
  cursor: help;
}

.token.title,
.token.title .token.punctuation {
  font-weight: bold;
  color: #1d3e81;
}

.token.list {
  color: #ed6a43;
}

.token.inserted {
  background-color: #eaffea;
  color: #55a532;
}

.token.deleted {
  background-color: #ffecec;
  color: #bd2c00;
}

.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}


/* JSON */
.language-json .token.property {
  color: #183691;
}

.language-markup .token.tag .token.punctuation {
  color: #333;
}

/* CSS */
code.language-css,
.language-css .token.function {
  color: #0086b3;
}

/* YAML */
.language-yaml .token.atrule {
  color: #63a35c;
}

code.language-yaml {
  color: #183691;
}

/* Ruby */
.language-ruby .token.function {
  color: #333;
}

/* Markdown */
.language-markdown .token.url {
  color: #795da3;
}

/* Makefile */
.language-makefile .token.symbol {
  color: #795da3;
}

.language-makefile .token.variable {
  color: #183691;
}

.language-makefile .token.builtin {
  color: #0086b3;
}

/* Bash */
.language-bash .token.keyword {
  color: #0086b3;
}

/* highlight */
pre[data-line] {
  position: relative;
  padding: 1em 0 1em 3em;
}
pre[data-line] .line-highlight-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  background-color: transparent;
  display: block;
  width: 100%;
}

pre[data-line] .line-highlight {
  position: absolute;
  left: 0;
  right: 0;
  padding: inherit 0;
  margin-top: 1em;
  background: hsla(24, 20%, 50%,.08);
  background: linear-gradient(to right, hsla(24, 20%, 50%,.1) 70%, hsla(24, 20%, 50%,0));
  pointer-events: none;
  line-height: inherit;
  white-space: pre;
}

pre[data-line] .line-highlight:before, 
pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-start);
  position: absolute;
  top: .4em;
  left: .6em;
  min-width: 1em;
  padding: 0 .5em;
  background-color: hsla(24, 20%, 50%,.4);
  color: hsl(24, 20%, 95%);
  font: bold 65%/1.5 sans-serif;
  text-align: center;
  vertical-align: .3em;
  border-radius: 999px;
  text-shadow: none;
  box-shadow: 0 1px white;
}

pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-end);
  top: auto;
  bottom: .4em;
}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{padding:0 1.6em;margin-top:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li{margin-bottom:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{list-style-type:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  150px);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
    </head>
    <body for="html-export">
      <div class="mume markdown-preview  ">
      <ul>
<li><a href="#%E7%AE%80%E8%BF%B0">&#x7B80;&#x8FF0;</a></li>
<li><a href="#1-java-%E5%B4%A9%E6%BA%83%E7%9A%84%E6%8D%95%E8%8E%B7">1 Java&#x3000;&#x5D29;&#x6E83;&#x7684;&#x6355;&#x83B7;</a></li>
<li><a href="#2-native-%E5%B4%A9%E6%BA%83%E7%9A%84%E6%8D%95%E8%8E%B7">2. Native &#x5D29;&#x6E83;&#x7684;&#x6355;&#x83B7;</a>
<ul>
<li><a href="#21-native-%E5%B4%A9%E6%BA%83%E6%8D%95%E8%8E%B7%E7%9A%84%E6%97%B6%E5%BA%8F">2.1 Native &#x5D29;&#x6E83;&#x6355;&#x83B7;&#x7684;&#x65F6;&#x5E8F;</a></li>
<li><a href="#22-xc_crash_init">2.2 xc_crash_init</a></li>
<li><a href="#23-xcc_signal_crash_register">2.3 xcc_signal_crash_register</a></li>
<li><a href="#24-xc_crash_signal_handler">2.4 xc_crash_signal_handler</a>
<ul>
<li><a href="#xc_crash_spot">xc_crash_spot</a></li>
<li><a href="#xc_crash_fork">xc_crash_fork</a></li>
<li><a href="#xc_crash_exec_dumper">xc_crash_exec_dumper</a></li>
<li><a href="#xcd_corecmain">xcd_core.c#main;</a></li>
<li><a href="#xcd_corecxcd_process_load_info">xcd_core.c#xcd_process_load_info</a></li>
<li><a href="#xcd_process_record">xcd_process_record</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#3-anr-%E7%9A%84%E6%8D%95%E8%8E%B7">3. ANR &#x7684;&#x6355;&#x83B7;</a>
<ul>
<li><a href="#xcc_signal_trace_register">xcc_signal_trace_register</a></li>
<li><a href="#xc_trace_dumper">xc_trace_dumper</a></li>
</ul>
</li>
<li><a href="#4-%E6%80%BB%E7%BB%93">4. &#x603B;&#x7ED3;</a></li>
<li><a href="#5-%E5%8F%82%E8%80%83">5. &#x53C2;&#x8003;</a></li>
</ul>
<h1 class="mume-header" id="%E7%AE%80%E8%BF%B0">&#x7B80;&#x8FF0;</h1>

<p>XCrash &#x7684;&#x5D29;&#x6E83;&#x6355;&#x83B7;&#x5206;&#x4E3A;, java &#x5D29;&#x6E83;&#x6355;&#x83B7;&#xFF0C;Native &#x5D29;&#x6E83;&#x6355;&#x83B7; &#x548C; Anr &#x5D29;&#x6E83;&#x6355;&#x83B7;&#x3002;</p>
<p>&#x8FD9;&#x662F; xcrash &#x662F;&#x7684;&#x67B6;&#x6784;&#x56FE;<br>
<img src="image/architecture.png"><br>
&#x56FE;&#x7247;&#x6765;&#x81EA; <a href="https://github.com/iqiyi/xCrash">xCrash &#x7684; github</a></p>
<ul>
<li>JavaCrashHandler &#x6355;&#x83B7; Java &#x5D29;&#x6E83;&#xFF0C;handleException &#x5904;&#x7406; java &#x5D29;</li>
<li>NativeHandler &#x6355;&#x83B7; native &#x5D29;&#x6E83;</li>
<li>AnrHandler &#x6355;&#x83B7; ABI &lt; 21 &#x7684; anr ,&#x9AD8;&#x4E8E;&#x7B49;&#x4E8E; 21 &#x7684;&#x5728; native &#x5C42;&#x6355;&#x83B7;</li>
</ul>
<h1 class="mume-header" id="1-java-%E5%B4%A9%E6%BA%83%E7%9A%84%E6%8D%95%E8%8E%B7">1 Java&#x3000;&#x5D29;&#x6E83;&#x7684;&#x6355;&#x83B7;</h1>

<h1 class="mume-header" id="2-native-%E5%B4%A9%E6%BA%83%E7%9A%84%E6%8D%95%E8%8E%B7">2. Native &#x5D29;&#x6E83;&#x7684;&#x6355;&#x83B7;</h1>

<p>Native &#x5D29;&#x6E83;&#x7684;&#x6355;&#x83B7;&#x4E3B;&#x8981;&#x662F;&#x4E24;&#x65B9;&#x9762;&#xFF1A;</p>
<ul>
<li>&#x4E00;&#x662F;&#x6355;&#x83B7;&#x5230;&#x5D29;&#x6E83;&#x4FE1;&#x53F7;</li>
<li>&#x4E8C;&#x662F;&#x5806;&#x6808;&#x7684;&#x56DE;&#x6EAF;&#xFF0C;&#x8FD8;&#x539F;&#x5D29;&#x6E83;&#x73B0;&#x573A;</li>
</ul>
<img src="image/capture_native_crash.png">
<p>&#x56FE;&#x7247;&#x6765;&#x81EA; <a href="https://github.com/iqiyi/xCrash">xCrash &#x7684; github</a></p>
<h2 class="mume-header" id="21-native-%E5%B4%A9%E6%BA%83%E6%8D%95%E8%8E%B7%E7%9A%84%E6%97%B6%E5%BA%8F">2.1 Native &#x5D29;&#x6E83;&#x6355;&#x83B7;&#x7684;&#x65F6;&#x5E8F;</h2>

<p><!--?xml version="1.0" encoding="UTF-8" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" contentscripttype="application/ecmascript" contentstyletype="text/css" height="292px" preserveAspectRatio="none" style="width:856px;height:292px;background:#FFFFFF;" version="1.1" viewBox="0 0 856 292" width="856px" zoomAndPan="magnify"><defs><filter height="300%" id="f1dpnd6d5trhjv" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="37" x2="37" y1="40.4883" y2="249.3516"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="257" x2="257" y1="40.4883" y2="249.3516"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="406.5" x2="406.5" y1="40.4883" y2="249.3516"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="595" x2="595" y1="40.4883" y2="249.3516"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="705" x2="705" y1="40.4883" y2="249.3516"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="803" x2="803" y1="40.4883" y2="249.3516"/><rect fill="#FEFECE" filter="url(#f1dpnd6d5trhjv)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="60" x="5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="12" y="25.5352">xcrash</text><rect fill="#FEFECE" filter="url(#f1dpnd6d5trhjv)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="60" x="5" y="248.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="12" y="268.8867">xcrash</text><rect fill="#FEFECE" filter="url(#f1dpnd6d5trhjv)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="110" x="200" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="207" y="25.5352">NativeHandler</text><rect fill="#FEFECE" filter="url(#f1dpnd6d5trhjv)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="110" x="200" y="248.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="207" y="268.8867">NativeHandler</text><rect fill="#FEFECE" filter="url(#f1dpnd6d5trhjv)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="65" x="372.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="379.5" y="25.5352">xc_jni.c</text><rect fill="#FEFECE" filter="url(#f1dpnd6d5trhjv)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="65" x="372.5" y="248.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="379.5" y="268.8867">xc_jni.c</text><rect fill="#FEFECE" filter="url(#f1dpnd6d5trhjv)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="108" x="539" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="546" y="25.5352">xc_common.c</text><rect fill="#FEFECE" filter="url(#f1dpnd6d5trhjv)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="108" x="539" y="248.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="546" y="268.8867">xc_common.c</text><rect fill="#FEFECE" filter="url(#f1dpnd6d5trhjv)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="85" x="661" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="71" x="668" y="25.5352">xc_crash.c</text><rect fill="#FEFECE" filter="url(#f1dpnd6d5trhjv)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="85" x="661" y="248.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="71" x="668" y="268.8867">xc_crash.c</text><rect fill="#FEFECE" filter="url(#f1dpnd6d5trhjv)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="82" x="760" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="767" y="25.5352">xc_trace.c</text><rect fill="#FEFECE" filter="url(#f1dpnd6d5trhjv)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="82" x="760" y="248.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="767" y="268.8867">xc_trace.c</text><polygon fill="#A80036" points="245,67.7988,255,71.7988,245,75.7988,249,71.7988" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="37" x2="251" y1="71.7988" y2="71.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196" x="44" y="67.0566">initialize: &#x521D;&#x59CB;&#x5316; &#x52A0;&#x8F7D; xcrash.so</text><polygon fill="#A80036" points="395,97.1094,405,101.1094,395,105.1094,399,101.1094" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="257" x2="401" y1="101.1094" y2="101.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="264" y="96.3672">xc_jni_init &#x521D;&#x59CB;&#x5316; &#x2460;</text><polygon fill="#A80036" points="583,126.4199,593,130.4199,583,134.4199,587,130.4199" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="407" x2="589" y1="130.4199" y2="130.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="414" y="125.6777">xc_common_ini &#x2461;</text><line style="stroke:#A80036;stroke-width:1.0;" x1="407" x2="449" y1="159.7305" y2="159.7305"/><line style="stroke:#A80036;stroke-width:1.0;" x1="449" x2="449" y1="159.7305" y2="172.7305"/><line style="stroke:#A80036;stroke-width:1.0;" x1="408" x2="449" y1="172.7305" y2="172.7305"/><polygon fill="#A80036" points="418,168.7305,408,172.7305,418,176.7305,414,172.7305" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174" x="414" y="154.9883">&#x8BBE;&#x7F6E;&#x5D29;&#x6E83;&#x662F; dump &#x7EBF;&#x7A0B;&#x767D;&#x540D;&#x5355;</text><polygon fill="#A80036" points="693.5,198.041,703.5,202.041,693.5,206.041,697.5,202.041" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="407" x2="699.5" y1="202.041" y2="202.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="414" y="197.2988">xc_crash_init: &#x2462;</text><polygon fill="#A80036" points="791,227.3516,801,231.3516,791,235.3516,795,231.3516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="407" x2="797" y1="231.3516" y2="231.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="414" y="226.6094">xc_trace_init &#x521D;&#x59CB;&#x5316; trace &#x6355;&#x83B7; anr</text><!--MD5=[1985d68d9844273b2b9f9e17fd167b06]
@startuml
xcrash -> NativeHandler: initialize: 初始化 加载 xcrash.so
NativeHandler -> xc_jni.c: xc_jni_init 初始化 ①
xc_jni.c -> xc_common.c : xc_common_ini ②
xc_jni.c -> xc_jni.c: 设置崩溃是 dump 线程白名单
xc_jni.c -> xc_crash.c: xc_crash_init: ③

xc_jni.c->xc_trace.c:xc_trace_init 初始化 trace 捕获 anr


@enduml

PlantUML version 1.2021.12(Wed Oct 06 00:01:58 CST 2021)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: zh
Country: CN
--></g></svg></p><ul>
<li><strong>&#x521D;&#x59CB;&#x5316;</strong></li>
</ul>
<p>NativeHandler#initialize<br>
&#x52A0;&#x8F7D; <a href="http://xcrash.so">xcrash.so</a><br>
&#x521D;&#x59CB;&#x5316; nativeInit</p>
<pre data-role="codeBlock" data-info="java" class="language-java"><span class="token keyword keyword-int">int</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> 
     
    <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">loadLibrary</span><span class="token punctuation">(</span><span class="token string">&quot;xcrash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>


    <span class="token keyword keyword-int">int</span> r <span class="token operator">=</span> <span class="token function">nativeInit</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</pre><ul>
<li><strong>xc_jni.c&#x521D;&#x59CB;&#x5316;</strong></li>
</ul>
<p>xc_jni.c &#x6587;&#x4EF6;</p>
<pre data-role="codeBlock" data-info="c" class="language-c"><span class="token keyword keyword-static">static</span> jint <span class="token function">xc_jni_init</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token function">xc_common_init</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>crash_enable<span class="token punctuation">)</span><span class="token punctuation">{</span>
         <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>crash_dump_all_threads_whitelist<span class="token punctuation">)</span><span class="token punctuation">{</span>

             <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

         <span class="token punctuation">}</span>

          <span class="token comment">//crash init</span>
        <span class="token comment">// &#x521D;&#x59CB;&#x5316;&#x7684;&#x91CD;&#x70B9;</span>
        r_crash <span class="token operator">=</span> <span class="token function">xc_crash_init</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>trace_enable<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//trace init</span>
        r_trace <span class="token operator">=</span> <span class="token function">xc_trace_init</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</pre><p>&#x8FD9;&#x662F; Native &#x7684;&#x5165;&#x53E3;</p>
<ul>
<li>
<p>xc_common_init<br>
&#x8FD9;&#x662F;&#x521D;&#x59CB;&#x5316;&#x4E00;&#x4E0B;&#x516C;&#x5171;&#x4FE1;&#x606F;&#xFF0C;&#x4F8B;&#x5982;&#x7248;&#x672C;&#x3001; ABI&#x3001;app_version &#x7248;&#x672C;&#x7B49;&#x4FE1;&#x606F;</p>
</li>
<li>
<p>crash_dump_all_threads_whitelist<br>
&#x8BBE;&#x7F6E;&#x5D29;&#x6E83;&#x662F; dump &#x767D;&#x540D;&#x5355;&#x7EBF;&#x7A0B;</p>
</li>
<li>
<p>xc_crash_init<br>
&#x8FD9;&#x4E2A;&#x662F;&#x521D;&#x59CB;&#x5316;&#x7684;&#x91CD;&#x70B9;, &#x540E;&#x9762;&#x4F1A;&#x8BE6;&#x7EC6;&#x8BB2;&#x8FF0;</p>
</li>
<li>
<p>xc_trace_init</p>
</li>
</ul>
<h2 class="mume-header" id="22-xc_crash_init">2.2 xc_crash_init</h2>

<p>xc_crash.c</p>
<pre data-role="codeBlock" data-info="c" class="language-c"><span class="token keyword keyword-int">int</span> <span class="token function">xc_crash_init</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>

    xc_crash_prepared_fd <span class="token operator">=</span> <span class="token function">XCC_UTIL_TEMP_FAILURE_RETRY</span><span class="token punctuation">(</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;/dev/null&quot;</span><span class="token punctuation">,</span> O_RDWR<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xc_crash_rethrow <span class="token operator">=</span> rethrow<span class="token punctuation">;</span>

    
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> <span class="token punctuation">(</span>xc_crash_emergency <span class="token operator">=</span> <span class="token function">calloc</span><span class="token punctuation">(</span>XC_CRASH_EMERGENCY_BUF_LEN<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> XCC_ERRNO_NOMEM<span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> <span class="token punctuation">(</span>xc_crash_dumper_pathname <span class="token operator">=</span> <span class="token function">xc_util_strdupcat</span><span class="token punctuation">(</span>xc_common_app_lib_dir<span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span>XCC_UTIL_XCRASH_DUMPER_FILENAME<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> XCC_ERRNO_NOMEM<span class="token punctuation">;</span>

    <span class="token comment">//init the local unwinder for fallback mode</span>
    <span class="token comment">// &#x2460; &#x6839;&#x636E;&#x4E0D;&#x540C;&#x7684; API &#x7248;&#x672C;&#xFF0C;&#x521D;&#x59CB;&#x5316;&#x5806;&#x6808;&#x56DE;&#x6EAF; so</span>
    <span class="token function">xcc_unwind_init</span><span class="token punctuation">(</span>xc_common_api_level<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//init for JNI callback</span>
    <span class="token comment">// &#x2461; &#x8BBE;&#x7F6E;&#x56DE;&#x8C03;&#xFF0C; &#x56DE;&#x8C03;&#x5230; NativeHandler &#x7684; crashCallback &#x65B9;&#x6CD5;</span>
    <span class="token function">xc_crash_init_callback</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//struct info passed to the dumper process</span>
    <span class="token comment">// dump &#x65F6;&#x4F7F;&#x7528;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;</span>
    <span class="token function">memset</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>

    <span class="token comment">//&#x2462; for clone and fork</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__i386__</span></span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> <span class="token punctuation">(</span>xc_crash_child_stack <span class="token operator">=</span> <span class="token function">calloc</span><span class="token punctuation">(</span>XC_CRASH_CHILD_STACK_LEN<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> XCC_ERRNO_NOMEM<span class="token punctuation">;</span>
    xc_crash_child_stack <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword keyword-void">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> <span class="token operator">*</span><span class="token punctuation">)</span>xc_crash_child_stack<span class="token punctuation">)</span> <span class="token operator">+</span> XC_CRASH_CHILD_STACK_LEN<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
    <span class="token comment">// pipe2 &#x521B;&#x5EFA;&#x7BA1;&#x9053;</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> <span class="token function">pipe2</span><span class="token punctuation">(</span>xc_crash_child_notifier<span class="token punctuation">,</span> O_CLOEXEC<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> XCC_ERRNO_SYS<span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
    
    <span class="token comment">//register signal handler</span>
    <span class="token comment">// &#x2463; &#x6CE8;&#x518C;&#x4FE1;&#x53F7;&#x6355;&#x83B7; handler</span>
    <span class="token keyword keyword-return">return</span> <span class="token function">xcc_signal_crash_register</span><span class="token punctuation">(</span>xc_crash_signal_handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><p><strong>xc_crash_init &#x662F;&#x6838;&#x5FC3;&#x65B9;&#x6CD5;</strong></p>
<ul>
<li>
<p>xc_crash_prepared_fd &#x662F;&#x4E3A;&#x5D29;&#x6E83;&#x65F6;&#x9884;&#x7559;&#x5B58;&#x50A8;&#x6587;&#x4EF6;</p>
</li>
<li>
<p>&#x2460;  xcc_unwind_init&#xFF0C; &#x6839;&#x636E;&#x4E0D;&#x540C;&#x7684; API &#x7248;&#x672C;&#xFF0C;&#x521D;&#x59CB;&#x5316;&#x5806;&#x6808;&#x56DE;&#x6EAF; so</p>
<ul>
<li>16 &gt;= API Level &lt;= 20, &#x4F7F;&#x7528; <a href="http://libcorkscrew.so">libcorkscrew.so</a></li>
<li>21 &gt;= API Level &lt;= 23, &#x4F7F;&#x7528; <a href="http://libunwind.so">libunwind.so</a></li>
<li>APL Level &gt;= 24, &#x53EF;&#x4EE5;&#x4F7F;&#x7528; _Unwind_Backtrace &#x76F4;&#x63A5;&#x8C03;&#x7528;</li>
</ul>
</li>
<li>
<p>&#x2461; xc_crash_init_callback&#xFF0C; &#x8BBE;&#x7F6E;&#x56DE;&#x8C03;&#xFF0C; &#x56DE;&#x8C03;&#x5230; NativeHandler &#x7684; crashCallback &#x65B9;&#x6CD5;</p>
</li>
<li>
<p>&#x2462; for clone and fork&#xFF0C; &#x5BF9;&#x4E8E; arm &#x67B6;&#x6784;&#x6765;&#x8BF4;&#xFF0C;&#x662F;&#x4F7F;&#x7528; pipe2 &#x521B;&#x5EFA;&#x7BA1;&#x9053;&#xFF0C;&#x7528;&#x6765;&#x901A;&#x77E5;&#x5D29;&#x6E83;&#x7684;&#x4FE1;&#x53F7;</p>
</li>
<li>
<p>&#x2463; xcc_signal_crash_register&#xFF0C; &#x6CE8;&#x518C;&#x4FE1;&#x53F7;&#x6355;&#x83B7; handler&#xFF0C;handler &#x662F; xc_crash_signal_handler</p>
</li>
</ul>
<h2 class="mume-header" id="23-xcc_signal_crash_register">2.3 xcc_signal_crash_register</h2>

<p>xcc_signal.c</p>
<pre data-role="codeBlock" data-info="c" class="language-c"><span class="token comment">// &#x9700;&#x8981;&#x76D1;&#x542C;&#x7684;&#x4FE1;&#x53F7;</span>
<span class="token keyword keyword-static">static</span> <span class="token class-name">xcc_signal_crash_info_t</span> xcc_signal_crash_info<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">{</span><span class="token punctuation">.</span>signum <span class="token operator">=</span> SIGABRT<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token punctuation">.</span>signum <span class="token operator">=</span> SIGBUS<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token punctuation">.</span>signum <span class="token operator">=</span> SIGFPE<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token punctuation">.</span>signum <span class="token operator">=</span> SIGILL<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token punctuation">.</span>signum <span class="token operator">=</span> SIGSEGV<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token punctuation">.</span>signum <span class="token operator">=</span> SIGTRAP<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token punctuation">.</span>signum <span class="token operator">=</span> SIGSYS<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token punctuation">.</span>signum <span class="token operator">=</span> SIGSTKFLT<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">xcc_signal_crash_register</span><span class="token punctuation">(</span><span class="token keyword keyword-void">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>handler<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token class-name">siginfo_t</span> <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword keyword-void">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// &#x2460; &#x8BBE;&#x7F6E;&#x800C;&#x5916;&#x7684;&#x6808;&#x7A7A;&#x95F4;</span>
    <span class="token class-name">stack_t</span> ss<span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> <span class="token punctuation">(</span>ss<span class="token punctuation">.</span>ss_sp <span class="token operator">=</span> <span class="token function">calloc</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> XCC_SIGNAL_CRASH_STACK_SIZE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> XCC_ERRNO_NOMEM<span class="token punctuation">;</span>
    ss<span class="token punctuation">.</span>ss_size  <span class="token operator">=</span> XCC_SIGNAL_CRASH_STACK_SIZE<span class="token punctuation">;</span>
    ss<span class="token punctuation">.</span>ss_flags <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> <span class="token function">sigaltstack</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ss<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> XCC_ERRNO_SYS<span class="token punctuation">;</span>

    <span class="token keyword keyword-struct">struct</span> <span class="token class-name">sigaction</span> act<span class="token punctuation">;</span>
    <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>act<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>act<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sigfillset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>act<span class="token punctuation">.</span>sa_mask<span class="token punctuation">)</span><span class="token punctuation">;</span>
    act<span class="token punctuation">.</span>sa_sigaction <span class="token operator">=</span> handler<span class="token punctuation">;</span>
    act<span class="token punctuation">.</span>sa_flags <span class="token operator">=</span> SA_RESTART <span class="token operator">|</span> SA_SIGINFO <span class="token operator">|</span> SA_ONSTACK<span class="token punctuation">;</span>
    
    <span class="token class-name">size_t</span> i<span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>xcc_signal_crash_info<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>xcc_signal_crash_info<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> <span class="token function">sigaction</span><span class="token punctuation">(</span>xcc_signal_crash_info<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>signum<span class="token punctuation">,</span> <span class="token operator">&amp;</span>act<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span>xcc_signal_crash_info<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>oldact<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-return">return</span> XCC_ERRNO_SYS<span class="token punctuation">;</span>

    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</pre><p>&#x2460; &#x8BBE;&#x7F6E;&#x800C;&#x5916;&#x7A7A;&#x95F4;</p>
<ul>
<li>SIGSEGV &#x6709;&#x53EF;&#x80FD;&#x662F;&#x6808;&#x6EA2;&#x51FA;&#x5F15;&#x8D77;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x5728;&#x9ED8;&#x8BA4;&#x7684;&#x6808;&#x4E0A;&#x8FD0;&#x884C;&#x5F88;&#x7528;&#x53EF;&#x80FD;&#x4F1A;&#x7834;&#x574F;&#x7A0B;&#x5E8F;&#x8FD0;&#x884C;&#x7684;&#x73B0;&#x573A;&#xFF0C;&#x65E0;&#x6CD5;&#x83B7;&#x5F97;&#x6B63;&#x786E;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x3002;&#x800C;&#x4E14;&#x5F53;&#x6808;&#x6EE1;&#x4E86;&#xFF0C;&#x7CFB;&#x7EDF;&#x4F1A;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x5DF2;&#x7ECF;&#x6EE1;&#x4E86;&#x7684;&#x6808;&#x4E0A;&#x8C03;&#x7528; SIGSEGV &#x7684;&#x4FE1;&#x53F7;&#x5904;&#x7406;&#x51FD;&#x6570;&#xFF0C;&#x53C8;&#x518D;&#x4E00;&#x6B21;&#x5F15;&#x8D77;&#x540C;&#x6837;&#x7684;&#x4FE1;&#x53F7;&#x3002;</li>
<li>&#x5F00;&#x8F9F;&#x4E00;&#x5757;&#x65B0;&#x7684;&#x7A7A;&#x95F4;&#x4F5C;&#x4E3A;&#x8FD0;&#x884C;&#x4FE1;&#x53F7;&#x5904;&#x7406;&#x51FD;&#x6570;&#x7684;&#x6808;&#x3002;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; sigaltstack &#x5728;&#x4EFB;&#x610F;&#x7EBF;&#x7A0B;&#x6CE8;&#x518C;&#x4E00;&#x4E2A;&#x53EF;&#x9009;&#x7684;&#x6808;&#xFF0C;&#x4FDD;&#x7559;&#x4E00;&#x4E0B;&#x8F7D;&#x7D27;&#x6025;&#x60C5;&#x51B5;&#x4E0B;&#x4F7F;&#x7528;&#x7684;&#x7A7A;&#x95F4;&#x3002;<br>
&#x51FA;&#x81EA; [<a href="https://mp.weixin.qq.com/s/g-WzYF3wWAljok1XjPoo7w?%5D">https://mp.weixin.qq.com/s/g-WzYF3wWAljok1XjPoo7w?]</a></li>
</ul>
<h2 class="mume-header" id="24-xc_crash_signal_handler">2.4 xc_crash_signal_handler</h2>

<p><strong>xc_crash.c#xc_crash_signal_handler</strong></p>
<p><!--?xml version="1.0" encoding="UTF-8" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" contentscripttype="application/ecmascript" contentstyletype="text/css" height="1666px" preserveAspectRatio="none" style="width:1042px;height:1666px;background:#FFFFFF;" version="1.1" viewBox="0 0 1042 1666" width="1042px" zoomAndPan="magnify"><defs><filter height="300%" id="f1smjbvjsa7ar" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><ellipse cx="357" cy="48.4961" fill="#000000" filter="url(#f1smjbvjsa7ar)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1smjbvjsa7ar)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="159" x="277.5" y="78.4961"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="139" x="287.5" y="100.0977">xc_crash_signal_handler</text><path d="M221.5,137.04 L221.5,162.3506 A0,0 0 0 0 221.5,162.3506 L310.5,162.3506 A0,0 0 0 0 310.5,162.3506 L310.5,155.04 L330.5,149.6953 L310.5,147.04 L310.5,147.04 L300.5,137.04 L221.5,137.04 A0,0 0 0 0 221.5,137.04 " fill="#FBFB77" filter="url(#f1smjbvjsa7ar)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M300.5,137.04 L300.5,147.04 L310.5,147.04 L300.5,137.04 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68" x="227.5" y="154.6084">&#x83B7;&#x53D6;&#x7EBF;&#x7A0B; id</text><rect fill="#FEFECE" filter="url(#f1smjbvjsa7ar)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="53" x="330.5" y="132.6289"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="33" x="340.5" y="154.2305">gettid</text><path d="M76.5,191.1729 L76.5,216.4834 A0,0 0 0 0 76.5,216.4834 L245.5,216.4834 A0,0 0 0 0 245.5,216.4834 L245.5,209.1729 L265.5,203.8281 L245.5,201.1729 L245.5,201.1729 L235.5,191.1729 L76.5,191.1729 A0,0 0 0 0 76.5,191.1729 " fill="#FBFB77" filter="url(#f1smjbvjsa7ar)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M235.5,191.1729 L235.5,201.1729 L245.5,201.1729 L235.5,191.1729 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="82.5" y="208.7412">create and open log file</text><rect fill="#FEFECE" filter="url(#f1smjbvjsa7ar)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="183" x="265.5" y="186.7617"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="163" x="275.5" y="208.3633">xc_common_open_crash_log</text><path d="M92.5,237.6504 L92.5,278.2715 A0,0 0 0 0 92.5,278.2715 L286.5,278.2715 A0,0 0 0 0 286.5,278.2715 L286.5,261.9609 L306.5,257.9609 L286.5,253.9609 L286.5,247.6504 L276.5,237.6504 L92.5,237.6504 A0,0 0 0 0 92.5,237.6504 " fill="#FBFB77" filter="url(#f1smjbvjsa7ar)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M276.5,237.6504 L276.5,247.6504 L286.5,247.6504 L276.5,237.6504 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="98.5" y="255.2188">&#x8BBE;&#x7F6E; crash &#x65F6;&#x7684;&#x4FE1;&#x606F;&#xFF0C;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="98.5" y="270.5293">&#x5305;&#x62EC;&#x5D29;&#x6E83;&#x65F6;&#x95F4;&#xFF0C;&#x5D29;&#x6E83;&#x7EBF;&#x7A0B;&#x7B49; &#x2460;</text><rect fill="#FEFECE" filter="url(#f1smjbvjsa7ar)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="101" x="306.5" y="240.8945"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="81" x="316.5" y="262.4961">xc_crash_spot</text><path d="M72.5,295.0273 L72.5,335.6484 A0,0 0 0 0 72.5,335.6484 L287.5,335.6484 A0,0 0 0 0 287.5,335.6484 L287.5,319.3379 L307.5,315.3379 L287.5,311.3379 L287.5,305.0273 L277.5,295.0273 L72.5,295.0273 A0,0 0 0 0 72.5,295.0273 " fill="#FBFB77" filter="url(#f1smjbvjsa7ar)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M277.5,295.0273 L277.5,305.0273 L287.5,305.0273 L277.5,295.0273 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="78.5" y="312.5957">fork &#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x90FD;&#x7528;&#x4E86; dump</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194" x="78.5" y="327.9063">&#x5185;&#x5BB9; xc_crash_exec_dumper &#x2461;</text><rect fill="#FEFECE" filter="url(#f1smjbvjsa7ar)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="99" x="307.5" y="298.2715"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="79" x="317.5" y="319.873">xc_crash_fork</text><path d="M87.5,1116.752 L87.5,1157.373 A0,0 0 0 0 87.5,1157.373 L234.5,1157.373 A0,0 0 0 0 234.5,1157.373 L234.5,1141.0625 L254.5,1137.0625 L234.5,1133.0625 L234.5,1126.752 L224.5,1116.752 L87.5,1116.752 A0,0 0 0 0 87.5,1116.752 " fill="#FBFB77" filter="url(#f1smjbvjsa7ar)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M224.5,1116.752 L224.5,1126.752 L234.5,1126.752 L224.5,1116.752 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="93.5" y="1134.3203">&#x68C0;&#x6D4B;&#x751F;&#x6210;&#x7684;backtrace</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="93.5" y="1149.6309">&#x5806;&#x6808;&#x56DE;&#x6EAF;&#x662F;&#x5426;&#x6709;&#x6548;</text><rect fill="#FEFECE" filter="url(#f1smjbvjsa7ar)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="205" x="254.5" y="1119.9961"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="185" x="264.5" y="1141.5977">xc_crash_check_backtrace_valid</text><path d="M71.5,1225.8506 L71.5,1266.4717 A0,0 0 0 0 71.5,1266.4717 L248.5,1266.4717 A0,0 0 0 0 248.5,1266.4717 L248.5,1250.1611 L268.5,1246.1611 L248.5,1242.1611 L248.5,1235.8506 L238.5,1225.8506 L71.5,1225.8506 A0,0 0 0 0 71.5,1225.8506 " fill="#FBFB77" filter="url(#f1smjbvjsa7ar)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M238.5,1225.8506 L238.5,1235.8506 L248.5,1235.8506 L238.5,1225.8506 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="77.5" y="1243.4189">&#x83B7;&#x53D6;&#x4E00;&#x4E9B;&#x516C;&#x5171;&#x4FE1;&#x606F;&#xFF0C;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="77.5" y="1258.7295">&#x4F8B;&#x5982;&#x7248;&#x672C;&#x3001;&#x624B;&#x673A;&#x54C1;&#x724C;&#x7B49;&#x4FE1;&#x606F;</text><rect fill="#FEFECE" filter="url(#f1smjbvjsa7ar)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="177" x="268.5" y="1229.0947"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="157" x="278.5" y="1250.6963">xc_fallback_get_emergency</text><path d="M20,1288.6611 L20,1359.9033 A0,0 0 0 0 20,1359.9033 L273,1359.9033 A0,0 0 0 0 273,1359.9033 L273,1328.2822 L293,1324.2822 L273,1320.2822 L273,1298.6611 L263,1288.6611 L20,1288.6611 A0,0 0 0 0 20,1288.6611 " fill="#FBFB77" filter="url(#f1smjbvjsa7ar)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M263,1288.6611 L263,1298.6611 L273,1298.6611 L263,1288.6611 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="199" x="26" y="1306.2295">xcc_util_record_logcat &#x83B7;&#x53D6;&#x65E5;&#x5FD7;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180" x="26" y="1321.54">xcc_util_record_fds &#x6587;&#x4EF6;&#x53E5;&#x67C4;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217" x="26" y="1336.8506">xcc_util_record_network_info &#x7F51;&#x7EDC;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="232" x="26" y="1352.1611">xcc_meminfo_record &#x5185;&#x5B58;map &#x7B49;&#x4FE1;&#x606F;</text><rect fill="#FEFECE" filter="url(#f1smjbvjsa7ar)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="128" x="293" y="1307.2158"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="108" x="303" y="1328.8174">xc_fallback_record</text><polygon fill="#FEFECE" filter="url(#f1smjbvjsa7ar)" points="332,1177.373,382,1177.373,394,1189.373,382,1201.373,332,1201.373,320,1189.373,332,1177.373" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="30" x="361" y="1212.0078">no ok</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="50" x="332" y="1193.5303">dump_ok</text><polygon fill="#FEFECE" filter="url(#f1smjbvjsa7ar)" points="357,1379.9033,369,1391.9033,357,1403.9033,345,1391.9033,357,1379.9033" style="stroke:#A80036;stroke-width:1.5;"/><path d="M84,1476.792 L84,1502.1025 A0,0 0 0 0 84,1502.1025 L229,1502.1025 A0,0 0 0 0 229,1502.1025 L229,1494.792 L249,1489.4473 L229,1486.792 L229,1486.792 L219,1476.792 L84,1476.792 A0,0 0 0 0 84,1476.792 " fill="#FBFB77" filter="url(#f1smjbvjsa7ar)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M219,1476.792 L219,1486.792 L229,1486.792 L219,1476.792 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="90" y="1494.3604">&#x83B7;&#x53D6; java &#x7684;&#x5806;&#x6808;&#x4FE1;&#x606F;</text><rect fill="#FEFECE" filter="url(#f1smjbvjsa7ar)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="216" x="249" y="1472.3809"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="196" x="259" y="1493.9824">xc_xcrash_record_java_stacktrace</text><polygon fill="#FEFECE" filter="url(#f1smjbvjsa7ar)" points="312.5,1423.9033,401.5,1423.9033,413.5,1435.9033,401.5,1447.9033,312.5,1447.9033,300.5,1435.9033,312.5,1423.9033" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="16" x="364" y="1458.5381">&gt;0</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="89" x="312.5" y="1440.0605">xc_crash_log_fd</text><polygon fill="#FEFECE" filter="url(#f1smjbvjsa7ar)" points="357,1526.5137,369,1538.5137,357,1550.5137,345,1538.5137,357,1526.5137" style="stroke:#A80036;stroke-width:1.5;"/><path d="M39.5,1567.2695 L39.5,1607.8906 A0,0 0 0 0 39.5,1607.8906 L275.5,1607.8906 A0,0 0 0 0 275.5,1607.8906 L275.5,1591.5801 L295.5,1587.5801 L275.5,1583.5801 L275.5,1577.2695 L265.5,1567.2695 L39.5,1567.2695 A0,0 0 0 0 39.5,1567.2695 " fill="#FBFB77" filter="url(#f1smjbvjsa7ar)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M265.5,1567.2695 L265.5,1577.2695 L275.5,1577.2695 L265.5,1567.2695 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="45.5" y="1584.8379">jni &#x56DE;&#x8C03;&#xFF0C;&#x56DE;&#x8C03;&#x5230;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="215" x="45.5" y="1600.1484">NativeHandler#crashCallback &#x65B9;&#x6CD5;</text><rect fill="#FEFECE" filter="url(#f1smjbvjsa7ar)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="123" x="295.5" y="1570.5137"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="103" x="305.5" y="1592.1152">xc_crash_callback</text><ellipse cx="357" cy="1638.8906" fill="#FFFFFF" filter="url(#f1smjbvjsa7ar)" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"/><ellipse cx="357" cy="1638.8906" fill="#000000" rx="6" ry="6" style="stroke:#7F7F7F;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:2.0;" x1="15" x2="15" y1="12.2969" y2="1649.8906"/><rect fill="#FEFECE" filter="url(#f1smjbvjsa7ar)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="155" x="521" y="355.6484"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="135" x="531" y="377.25">xc_crash_exec_dumper</text><path d="M645.5,414.1924 L645.5,422.8477 L625.5,426.8477 L645.5,430.8477 L645.5,439.5029 A0,0 0 0 0 645.5,439.5029 L776.5,439.5029 A0,0 0 0 0 776.5,439.5029 L776.5,424.1924 L766.5,414.1924 L645.5,414.1924 A0,0 0 0 0 645.5,414.1924 " fill="#FBFB77" filter="url(#f1smjbvjsa7ar)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M766.5,414.1924 L766.5,424.1924 L776.5,424.1924 L766.5,414.1924 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110" x="651.5" y="431.7607">set args pipe size</text><rect fill="#FEFECE" filter="url(#f1smjbvjsa7ar)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="54" x="571.5" y="409.7813"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="34" x="581.5" y="431.3828">pipe2</text><path d="M708,468.3252 L708,476.9805 L688,480.9805 L708,484.9805 L708,493.6357 A0,0 0 0 0 708,493.6357 L938,493.6357 A0,0 0 0 0 938,493.6357 L938,478.3252 L928,468.3252 L708,468.3252 A0,0 0 0 0 708,468.3252 " fill="#FBFB77" filter="url(#f1smjbvjsa7ar)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M928,468.3252 L928,478.3252 L938,478.3252 L928,468.3252 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209" x="714" y="485.8936">&#x52A0;&#x8F7D; libxcrash_dumper.so &#x6587;&#x4EF6; &#x2462;</text><rect fill="#FEFECE" filter="url(#f1smjbvjsa7ar)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="179" x="509" y="463.9141"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="159" x="519" y="485.5156">execl(libxcrash_dumper.so)</text><path d="M672.5,522.458 L672.5,531.1133 L652.5,535.1133 L672.5,539.1133 L672.5,547.7686 A0,0 0 0 0 672.5,547.7686 L921.5,547.7686 A0,0 0 0 0 921.5,547.7686 L921.5,532.458 L911.5,522.458 L672.5,522.458 A0,0 0 0 0 672.5,522.458 " fill="#FBFB77" filter="url(#f1smjbvjsa7ar)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M911.5,522.458 L911.5,532.458 L921.5,532.458 L911.5,522.458 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="228" x="678.5" y="540.0264">&#x4ECE; xcd_core.c &#x7684;main&#x65B9;&#x6CD5;&#x5F00;&#x59CB;&#x6267;&#x884C; &#x2463;</text><rect fill="#FEFECE" filter="url(#f1smjbvjsa7ar)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="108" x="544.5" y="518.0469"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="88" x="554.5" y="539.6484">xcd_core#main</text><path d="M686.5,576.5908 L686.5,585.2461 L666.5,589.2461 L686.5,593.2461 L686.5,601.9014 A0,0 0 0 0 686.5,601.9014 L759.5,601.9014 A0,0 0 0 0 759.5,601.9014 L759.5,586.5908 L749.5,576.5908 L686.5,576.5908 A0,0 0 0 0 686.5,576.5908 " fill="#FBFB77" filter="url(#f1smjbvjsa7ar)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M749.5,576.5908 L749.5,586.5908 L759.5,586.5908 L749.5,576.5908 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="692.5" y="594.1592">&#x8BFB;&#x53D6;&#x53C2;&#x6570;</text><rect fill="#FEFECE" filter="url(#f1smjbvjsa7ar)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="136" x="530.5" y="572.1797"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="116" x="540.5" y="593.7813">xcd_core_read_args</text><rect fill="#FEFECE" filter="url(#f1smjbvjsa7ar)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="70" x="563.5" y="626.3125"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="50" x="573.5" y="647.9141">open log</text><path d="M673,677.2012 L673,693.5117 L653,697.5117 L673,701.5117 L673,717.8223 A0,0 0 0 0 673,717.8223 L920,717.8223 A0,0 0 0 0 920,717.8223 L920,687.2012 L910,677.2012 L673,677.2012 A0,0 0 0 0 673,677.2012 " fill="#FBFB77" filter="url(#f1smjbvjsa7ar)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M910,677.2012 L910,687.2012 L920,687.2012 L910,677.2012 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="679" y="694.7695">&#x521D;&#x59CB;&#x5316;&#x5806;&#x6808;&#x56DE;&#x6EAF;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226" x="679" y="710.0801">&#x4E3A;&#x4E86;&#x6355;&#x83B7; dump &#x5B50;&#x8FDB;&#x7A0B;&#x53EF;&#x80FD;&#x53D1;&#x751F;&#x7684;&#x5D29;&#x6E83;</text><rect fill="#FEFECE" filter="url(#f1smjbvjsa7ar)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="109" x="544" y="680.4453"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="89" x="554" y="702.0469">xcc_unwind_init</text><path d="M701,734.5781 L701,750.8887 L681,754.8887 L701,758.8887 L701,775.1992 A0,0 0 0 0 701,775.1992 L948,775.1992 A0,0 0 0 0 948,775.1992 L948,744.5781 L938,734.5781 L701,734.5781 A0,0 0 0 0 701,734.5781 " fill="#FBFB77" filter="url(#f1smjbvjsa7ar)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M938,734.5781 L938,744.5781 L948,744.5781 L938,734.5781 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68" x="707" y="752.1465">&#x6CE8;&#x518C; signal</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226" x="707" y="767.457">&#x4E3A;&#x4E86;&#x6355;&#x83B7; dump &#x5B50;&#x8FDB;&#x7A0B;&#x53EF;&#x80FD;&#x53D1;&#x751F;&#x7684;&#x5D29;&#x6E83;</text><rect fill="#FEFECE" filter="url(#f1smjbvjsa7ar)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="165" x="516" y="737.8223"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="145" x="526" y="759.4238">xcc_signal_crash_register</text><path d="M685.5,799.6104 L685.5,808.2656 L665.5,812.2656 L685.5,816.2656 L685.5,824.9209 A0,0 0 0 0 685.5,824.9209 L875.5,824.9209 A0,0 0 0 0 875.5,824.9209 L875.5,809.6104 L865.5,799.6104 L685.5,799.6104 A0,0 0 0 0 685.5,799.6104 " fill="#FBFB77" filter="url(#f1smjbvjsa7ar)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M865.5,799.6104 L865.5,809.6104 L875.5,809.6104 L865.5,799.6104 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169" x="691.5" y="817.1787">&#x7EDF;&#x8BA1;&#x5D29;&#x6E83;&#x8FDB;&#x7A0B;&#x7684;&#x6240;&#x6709;&#x7EBF;&#x7A0B;&#x4FE1;&#x606F;</text><rect fill="#FEFECE" filter="url(#f1smjbvjsa7ar)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="134" x="531.5" y="795.1992"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="114" x="541.5" y="816.8008">xcd_process_create</text><path d="M717,853.7432 L717,862.3984 L697,866.3984 L717,870.3984 L717,879.0537 A0,0 0 0 0 717,879.0537 L829,879.0537 A0,0 0 0 0 829,879.0537 L829,863.7432 L819,853.7432 L717,853.7432 A0,0 0 0 0 717,853.7432 " fill="#FBFB77" filter="url(#f1smjbvjsa7ar)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M819,853.7432 L819,863.7432 L829,863.7432 L819,853.7432 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="723" y="871.3115">&#x6302;&#x8D77;&#x6240;&#x6709;&#x7684;&#x7EBF;&#x7A0B;</text><rect fill="#FEFECE" filter="url(#f1smjbvjsa7ar)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="197" x="500" y="849.332"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="177" x="510" y="870.9336">xcd_process_suspend_threads</text><path d="M693.5,907.876 L693.5,916.5313 L673.5,920.5313 L693.5,924.5313 L693.5,933.1865 A0,0 0 0 0 693.5,933.1865 L1017.5,933.1865 A0,0 0 0 0 1017.5,933.1865 L1017.5,917.876 L1007.5,907.876 L693.5,907.876 A0,0 0 0 0 693.5,907.876 " fill="#FBFB77" filter="url(#f1smjbvjsa7ar)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1007.5,907.876 L1007.5,917.876 L1017.5,917.876 L1007.5,907.876 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="303" x="699.5" y="925.4443">&#x83B7;&#x53D6;&#x8FDB;&#x7A0B;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x5305;&#x542B;&#x8FDB;&#x7A0B;&#x3001;&#x7EBF;&#x7A0B;&#x548C;&#x5185;&#x5B58;&#x6620;&#x5C04;&#x4FE1;&#x606F; &#x2464;</text><rect fill="#FEFECE" filter="url(#f1smjbvjsa7ar)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="150" x="523.5" y="903.4648"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="130" x="533.5" y="925.0664">xcd_process_load_info</text><path d="M673,962.0088 L673,970.6641 L653,974.6641 L673,978.6641 L673,987.3193 A0,0 0 0 0 673,987.3193 L929,987.3193 A0,0 0 0 0 929,987.3193 L929,972.0088 L919,962.0088 L673,962.0088 A0,0 0 0 0 673,962.0088 " fill="#FBFB77" filter="url(#f1smjbvjsa7ar)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M919,962.0088 L919,972.0088 L929,972.0088 L919,962.0088 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235" x="679" y="979.5771">&#x8BB0;&#x5F55;&#x7CFB;&#x7EDF;&#x4FE1;&#x606F;&#xFF0C;&#x5305;&#x542B; ABI Version &#x7248;&#x672C;&#x7B49;</text><rect fill="#FEFECE" filter="url(#f1smjbvjsa7ar)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="109" x="544" y="957.5977"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="89" x="554" y="979.1992">xcd_sys_record</text><path d="M686.5,1016.1416 L686.5,1024.7969 L666.5,1028.7969 L686.5,1032.7969 L686.5,1041.4521 A0,0 0 0 0 686.5,1041.4521 L802.5,1041.4521 A0,0 0 0 0 802.5,1041.4521 L802.5,1026.1416 L792.5,1016.1416 L686.5,1016.1416 A0,0 0 0 0 686.5,1016.1416 " fill="#FBFB77" filter="url(#f1smjbvjsa7ar)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M792.5,1016.1416 L792.5,1026.1416 L802.5,1026.1416 L792.5,1016.1416 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95" x="692.5" y="1033.71">&#x8BB0;&#x5F55;&#x8FDB;&#x7A0B;&#x4FE1;&#x606F; &#x2465;</text><rect fill="#FEFECE" filter="url(#f1smjbvjsa7ar)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="136" x="530.5" y="1011.7305"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="116" x="540.5" y="1033.332">xcd_process_record</text><path d="M714,1070.2744 L714,1078.9297 L694,1082.9297 L714,1086.9297 L714,1095.585 A0,0 0 0 0 714,1095.585 L826,1095.585 A0,0 0 0 0 826,1095.585 L826,1080.2744 L816,1070.2744 L714,1070.2744 A0,0 0 0 0 714,1070.2744 " fill="#FBFB77" filter="url(#f1smjbvjsa7ar)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M816,1070.2744 L816,1080.2744 L826,1080.2744 L816,1070.2744 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="720" y="1087.8428">&#x6062;&#x590D;&#x6240;&#x6709;&#x7684;&#x7EBF;&#x7A0B;</text><rect fill="#FEFECE" filter="url(#f1smjbvjsa7ar)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="191" x="503" y="1065.8633"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="171" x="513" y="1087.4648">xcd_process_resume_threads</text><line style="stroke:#000000;stroke-width:2.0;" x1="494" x2="494" y1="12.2969" y2="1649.8906"/><line style="stroke:#000000;stroke-width:2.0;" x1="1022.5" x2="1022.5" y1="12.2969" y2="1649.8906"/><line style="stroke:#A80036;stroke-width:1.5;" x1="357" x2="357" y1="58.4961" y2="78.4961"/><polygon fill="#A80036" points="353,68.4961,357,78.4961,361,68.4961,357,72.4961" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="357" x2="357" y1="112.6289" y2="132.6289"/><polygon fill="#A80036" points="353,122.6289,357,132.6289,361,122.6289,357,126.6289" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="357" x2="357" y1="166.7617" y2="186.7617"/><polygon fill="#A80036" points="353,176.7617,357,186.7617,361,176.7617,357,180.7617" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="357" x2="357" y1="220.8945" y2="240.8945"/><polygon fill="#A80036" points="353,230.8945,357,240.8945,361,230.8945,357,234.8945" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="357" x2="357" y1="275.0273" y2="298.2715"/><polygon fill="#A80036" points="353,288.2715,357,298.2715,361,288.2715,357,292.2715" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="357" x2="357" y1="1263.2275" y2="1307.2158"/><polygon fill="#A80036" points="353,1297.2158,357,1307.2158,361,1297.2158,357,1301.2158" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="357" x2="357" y1="1201.373" y2="1229.0947"/><polygon fill="#A80036" points="353,1219.0947,357,1229.0947,361,1219.0947,357,1223.0947" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="394" x2="455.5" y1="1189.373" y2="1189.373"/><polygon fill="#A80036" points="451.5,1276.4717,455.5,1286.4717,459.5,1276.4717,455.5,1280.4717" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="455.5" x2="455.5" y1="1189.373" y2="1391.9033"/><line style="stroke:#A80036;stroke-width:1.5;" x1="455.5" x2="369" y1="1391.9033" y2="1391.9033"/><polygon fill="#A80036" points="379,1387.9033,369,1391.9033,379,1395.9033,375,1391.9033" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="357" x2="357" y1="1341.3486" y2="1379.9033"/><polygon fill="#A80036" points="353,1369.9033,357,1379.9033,361,1369.9033,357,1373.9033" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="357" x2="357" y1="1154.1289" y2="1177.373"/><polygon fill="#A80036" points="353,1167.373,357,1177.373,361,1167.373,357,1171.373" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="357" x2="357" y1="1447.9033" y2="1472.3809"/><polygon fill="#A80036" points="353,1462.3809,357,1472.3809,361,1462.3809,357,1466.3809" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="413.5" x2="475" y1="1435.9033" y2="1435.9033"/><polygon fill="#A80036" points="471,1479.4473,475,1489.4473,479,1479.4473,475,1483.4473" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="475" x2="475" y1="1435.9033" y2="1538.5137"/><line style="stroke:#A80036;stroke-width:1.5;" x1="475" x2="369" y1="1538.5137" y2="1538.5137"/><polygon fill="#A80036" points="379,1534.5137,369,1538.5137,379,1542.5137,375,1538.5137" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="357" x2="357" y1="1506.5137" y2="1526.5137"/><polygon fill="#A80036" points="353,1516.5137,357,1526.5137,361,1516.5137,357,1520.5137" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="357" x2="357" y1="1403.9033" y2="1423.9033"/><polygon fill="#A80036" points="353,1413.9033,357,1423.9033,361,1413.9033,357,1417.9033" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="357" x2="357" y1="1550.5137" y2="1570.5137"/><polygon fill="#A80036" points="353,1560.5137,357,1570.5137,361,1560.5137,357,1564.5137" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="357" x2="357" y1="1604.6465" y2="1627.8906"/><polygon fill="#A80036" points="353,1617.8906,357,1627.8906,361,1617.8906,357,1621.8906" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="598.5" x2="598.5" y1="389.7813" y2="409.7813"/><polygon fill="#A80036" points="594.5,399.7813,598.5,409.7813,602.5,399.7813,598.5,403.7813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="598.5" x2="598.5" y1="443.9141" y2="463.9141"/><polygon fill="#A80036" points="594.5,453.9141,598.5,463.9141,602.5,453.9141,598.5,457.9141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="598.5" x2="598.5" y1="498.0469" y2="518.0469"/><polygon fill="#A80036" points="594.5,508.0469,598.5,518.0469,602.5,508.0469,598.5,512.0469" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="598.5" x2="598.5" y1="552.1797" y2="572.1797"/><polygon fill="#A80036" points="594.5,562.1797,598.5,572.1797,602.5,562.1797,598.5,566.1797" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="598.5" x2="598.5" y1="606.3125" y2="626.3125"/><polygon fill="#A80036" points="594.5,616.3125,598.5,626.3125,602.5,616.3125,598.5,620.3125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="598.5" x2="598.5" y1="660.4453" y2="680.4453"/><polygon fill="#A80036" points="594.5,670.4453,598.5,680.4453,602.5,670.4453,598.5,674.4453" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="598.5" x2="598.5" y1="714.5781" y2="737.8223"/><polygon fill="#A80036" points="594.5,727.8223,598.5,737.8223,602.5,727.8223,598.5,731.8223" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="598.5" x2="598.5" y1="771.9551" y2="795.1992"/><polygon fill="#A80036" points="594.5,785.1992,598.5,795.1992,602.5,785.1992,598.5,789.1992" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="598.5" x2="598.5" y1="829.332" y2="849.332"/><polygon fill="#A80036" points="594.5,839.332,598.5,849.332,602.5,839.332,598.5,843.332" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="598.5" x2="598.5" y1="883.4648" y2="903.4648"/><polygon fill="#A80036" points="594.5,893.4648,598.5,903.4648,602.5,893.4648,598.5,897.4648" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="598.5" x2="598.5" y1="937.5977" y2="957.5977"/><polygon fill="#A80036" points="594.5,947.5977,598.5,957.5977,602.5,947.5977,598.5,951.5977" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="598.5" x2="598.5" y1="991.7305" y2="1011.7305"/><polygon fill="#A80036" points="594.5,1001.7305,598.5,1011.7305,602.5,1001.7305,598.5,1005.7305" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="598.5" x2="598.5" y1="1045.8633" y2="1065.8633"/><polygon fill="#A80036" points="594.5,1055.8633,598.5,1065.8633,602.5,1055.8633,598.5,1059.8633" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="357" x2="357" y1="332.4043" y2="340.6484"/><line style="stroke:#A80036;stroke-width:1.5;" x1="357" x2="598.5" y1="340.6484" y2="340.6484"/><line style="stroke:#A80036;stroke-width:1.5;" x1="598.5" x2="598.5" y1="340.6484" y2="355.6484"/><polygon fill="#A80036" points="594.5,345.6484,598.5,355.6484,602.5,345.6484,598.5,349.6484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="598.5" x2="598.5" y1="1099.9961" y2="1104.9961"/><line style="stroke:#A80036;stroke-width:1.5;" x1="598.5" x2="357" y1="1104.9961" y2="1104.9961"/><line style="stroke:#A80036;stroke-width:1.5;" x1="357" x2="357" y1="1104.9961" y2="1119.9961"/><polygon fill="#A80036" points="353,1109.9961,357,1119.9961,361,1109.9961,357,1113.9961" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="54" x="227.5" y="29.6992">&#x4E3B;&#x8FDB;&#x7A0B;</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="54" x="731.25" y="29.6992">&#x5B50;&#x8FDB;&#x7A0B;</text><!--MD5=[068f333d2cfa918b74524d9e904cb35d]
@startuml
|主进程|
start
:xc_crash_signal_handler;
:gettid; 
note left: 获取线程 id
:xc_common_open_crash_log;
note left: create and open log file
:xc_crash_spot;
note left: 设置 crash 时的信息，\n包括崩溃时间，崩溃线程等 ①
:xc_crash_fork;
note left: fork 一个进程都用了 dump \n内容 xc_crash_exec_dumper ②
|子进程|
:xc_crash_exec_dumper;
:pipe2;
note right: set args pipe size
:execl(libxcrash_dumper.so);
note right: 加载 libxcrash_dumper.so 文件 ③
:xcd_core#main; 
note right: 从 xcd_core.c 的main方法开始执行 ④
:xcd_core_read_args;
note right: 读取参数
:open log;
:xcc_unwind_init;
note right: 初始化堆栈回溯\n为了捕获 dump 子进程可能发生的崩溃
:xcc_signal_crash_register;
note right: 注册 signal\n为了捕获 dump 子进程可能发生的崩溃
:xcd_process_create;
note right: 统计崩溃进程的所有线程信息
:xcd_process_suspend_threads;
note right: 挂起所有的线程
:xcd_process_load_info; 
note right: 获取进程的信息，包含进程、线程和内存映射信息 ⑤
:xcd_sys_record;
note right: 记录系统信息，包含 ABI Version 版本等
:xcd_process_record;
note right: 记录进程信息 ⑥
:xcd_process_resume_threads;
note right: 恢复所有的线程

|主进程|
:xc_crash_check_backtrace_valid;
note left:检测生成的backtrace\n堆栈回溯是否有效
if(dump_ok) is (no ok) then
:xc_fallback_get_emergency;
note left:获取一些公共信息，\n例如版本、手机品牌等信息
:xc_fallback_record;
note left: xcc_util_record_logcat 获取日志\nxcc_util_record_fds 文件句柄\nxcc_util_record_network_info 网络\nxcc_meminfo_record 内存map 等信息
endif
if(xc_crash_log_fd) is ( >0 ) then
:xc_xcrash_record_java_stacktrace;
note left: 获取 java 的堆栈信息
endif
:xc_crash_callback;
note left: jni 回调，回调到 \nNativeHandler#crashCallback 方法
stop

@enduml

PlantUML version 1.2021.12(Wed Oct 06 00:01:58 CST 2021)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: zh
Country: CN
--></g></svg></p><h3 class="mume-header" id="xc_crash_spot">xc_crash_spot</h3>

<p>&#x2460; &#x8BBE;&#x7F6E; crash &#x65F6;&#x7684;&#x4FE1;&#x606F;&#x3001;&#x5305;&#x62EC;&#x5D29;&#x6E83;&#x65F6;&#x95F4;&#x3001;&#x5D29;&#x6E83;&#x7EBF;&#x7A0B;&#x7B49;</p>
<pre data-role="codeBlock" data-info="c" class="language-c"><span class="token comment">//set crash spot info</span>
<span class="token comment">// &#x8BBE;&#x7F6E;&#x5D29;&#x6E83;&#x7684;&#x65F6;&#x95F4;</span>
xc_crash_spot<span class="token punctuation">.</span>crash_time <span class="token operator">=</span> xc_crash_time<span class="token punctuation">;</span>
<span class="token comment">// &#x5D29;&#x6E83;&#x7684;&#x7EBF;&#x7A0B; ID</span>
xc_crash_spot<span class="token punctuation">.</span>crash_tid <span class="token operator">=</span> xc_crash_tid<span class="token punctuation">;</span>
<span class="token function">memcpy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>xc_crash_spot<span class="token punctuation">.</span>siginfo<span class="token punctuation">)</span><span class="token punctuation">,</span> si<span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token class-name">siginfo_t</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">memcpy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>xc_crash_spot<span class="token punctuation">.</span>ucontext<span class="token punctuation">)</span><span class="token punctuation">,</span> uc<span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token class-name">ucontext_t</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// &#x5D29;&#x6E83;log &#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x957F;&#x5EA6;</span>
xc_crash_spot<span class="token punctuation">.</span>log_pathname_len <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>xc_crash_log_pathname<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="xc_crash_fork">xc_crash_fork</h3>

<p>&#x2461; fork &#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x90FD;&#x7528;&#x4E86; dump &#x5185;&#x5BB9; xc_crash_exec_dumper</p>
<pre data-role="codeBlock" data-info="c" class="language-c"><span class="token keyword keyword-static">static</span> <span class="token keyword keyword-int">int</span> <span class="token function">xc_crash_fork</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>fn<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword keyword-void">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__i386__</span></span>
    <span class="token keyword keyword-return">return</span> <span class="token function">clone</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> xc_crash_child_stack<span class="token punctuation">,</span> CLONE_VFORK <span class="token operator">|</span> CLONE_FS <span class="token operator">|</span> CLONE_UNTRACED<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
    <span class="token comment">// fork &#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;</span>
    <span class="token class-name">pid_t</span> dumper_pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
<span class="token punctuation">}</span>
</pre><h3 class="mume-header" id="xc_crash_exec_dumper">xc_crash_exec_dumper</h3>

<p>xc_crash_exec_dumper &#x662F;&#x5728;&#x5B50;&#x8FDB;&#x7A0B;&#x4E2D;&#x6267;&#x884C;&#x4E86;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x6709;&#x4E24;&#x4E2A;&#x529F;&#x80FD;&#xFF1A;</p>
<ul>
<li>&#x4E00;&#x662F;, &#x8BBE;&#x7F6E; pipe &#x7BA1;&#x9053;&#x53C2;&#x6570;&#xFF0C;set args pipe size</li>
<li>&#x4E8C;&#x662F;&#xFF0C;&#x52A0;&#x8F7D; libxcrash_dumper.so &#x6587;&#x4EF6; &#x2462;</li>
</ul>
<pre data-role="codeBlock" data-info="c" class="language-c"><span class="token keyword keyword-static">static</span> <span class="token keyword keyword-int">int</span> <span class="token function">xc_crash_exec_dumper</span><span class="token punctuation">(</span><span class="token keyword keyword-void">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

     <span class="token comment">//set args pipe size</span>
    <span class="token comment">// &#x8BBE;&#x7F6E;&#x7BA1;&#x9053;&#x53C2;&#x6570;</span>
    <span class="token comment">//range: pagesize (4K) ~ /proc/sys/fs/pipe-max-size (1024K)</span>
    <span class="token keyword keyword-int">int</span> write_len <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token class-name">xcc_spot_t</span><span class="token punctuation">)</span> <span class="token operator">+</span>
                          xc_crash_spot<span class="token punctuation">.</span>log_pathname_len <span class="token operator">+</span>
                          xc_crash_spot<span class="token punctuation">.</span>os_version_len <span class="token operator">+</span>
                          xc_crash_spot<span class="token punctuation">.</span>kernel_version_len <span class="token operator">+</span>
                          xc_crash_spot<span class="token punctuation">.</span>abi_list_len <span class="token operator">+</span>
                          xc_crash_spot<span class="token punctuation">.</span>manufacturer_len <span class="token operator">+</span>
                          xc_crash_spot<span class="token punctuation">.</span>brand_len <span class="token operator">+</span>
                          xc_crash_spot<span class="token punctuation">.</span>model_len <span class="token operator">+</span>
                          xc_crash_spot<span class="token punctuation">.</span>build_fingerprint_len <span class="token operator">+</span>
                          xc_crash_spot<span class="token punctuation">.</span>app_id_len <span class="token operator">+</span>
                          xc_crash_spot<span class="token punctuation">.</span>app_version_len <span class="token operator">+</span>
                          xc_crash_spot<span class="token punctuation">.</span>dump_all_threads_whitelist_len<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token comment">//escape to the dumper process</span>
    errno <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">// &#x52A0;&#x8F7D; &quot;libxcrash_dumper.so&quot;</span>
    <span class="token comment">// XCC_UTIL_XCRASH_DUMPER_FILENAME &quot;libxcrash_dumper.so&quot;</span>
    <span class="token function">execl</span><span class="token punctuation">(</span>xc_crash_dumper_pathname<span class="token punctuation">,</span> XCC_UTIL_XCRASH_DUMPER_FILENAME<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">100</span> <span class="token operator">+</span> errno<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><h3 class="mume-header" id="xcd_corecmain">xcd_core.c#main;</h3>

<p>&#x2463; &#x4ECE; xcd_core.c &#x7684; main&#x65B9;&#x6CD5;&#x5F00;&#x59CB;&#x6267;&#x884C;<br>
&#x5F53;&#x52A0;&#x8F7D; libxcrash_dumper.so, &#x5F00;&#x59CB;&#x6267;&#x884C;&#x7684;&#x65B9;&#x6CD5;&#x662F; xcd_core.c#main &#x65B9;&#x6CD5;<br>
main &#x65B9;&#x6CD5;&#x91CC;&#x9762;&#x5305;&#x542B;&#x4E86;&#x51E0;&#x4E2A;&#x6B65;&#x9AA4;&#xFF1A;</p>
<ul>
<li>xcc_unwind_init, &#x521D;&#x59CB;&#x5316;&#x5806;&#x6808;&#x56DE;&#x6EAF;&#xFF0C;&#x4E3A;&#x4E86;&#x6355;&#x83B7; dump &#x5B50;&#x8FDB;&#x7A0B;&#x53EF;&#x80FD;&#x53D1;&#x751F;&#x7684;&#x5D29;&#x6E83;</li>
<li>xcc_signal_crash_register, &#x6CE8;&#x518C; signal, &#x4E3A;&#x4E86;&#x6355;&#x83B7; dump &#x5B50;&#x8FDB;&#x7A0B;&#x53EF;&#x80FD;&#x53D1;&#x751F;&#x7684;&#x5D29;&#x6E83;</li>
<li>xcd_process_create&#xFF0C;&#x7EDF;&#x8BA1;&#x5D29;&#x6E83;&#x8FDB;&#x7A0B;&#x7684;&#x6240;&#x6709;&#x7EBF;&#x7A0B;&#x4FE1;&#x606F;</li>
<li>xcd_process_suspend_threads, &#x6302;&#x8D77;&#x8BE5;&#x8FDB;&#x7A0B; &#x7684;&#x6240;&#x6709;&#x7EBF;&#x7A0B;</li>
<li>xcd_process_load_info, &#x83B7;&#x53D6;&#x8FDB;&#x7A0B;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x5305;&#x542B;&#x8FDB;&#x7A0B;&#x3001;&#x7EBF;&#x7A0B;&#x548C;&#x5185;&#x5B58;&#x6620;&#x5C04;&#x4FE1;&#x606F;</li>
<li>xcd_sys_record, &#x8BB0;&#x5F55;&#x7CFB;&#x7EDF;&#x4FE1;&#x606F;&#xFF0C;&#x5305;&#x542B; ABI Version &#x7248;&#x672C;&#x7B49;</li>
<li>xcd_process_record, &#x8BB0;&#x5F55;&#x8FDB;&#x7A0B;&#x4FE1;&#x606F;</li>
<li>xcd_process_resume_threads,&#x6062;&#x590D;&#x6240;&#x6709;&#x7EBF;&#x7A0B;</li>
</ul>
<h3 class="mume-header" id="xcd_corecxcd_process_load_info">xcd_core.c#xcd_process_load_info</h3>

<p>xcd_process_load_info &#x6700;&#x7EC8;&#x901A;&#x8FC7; xcd_maps_create &#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#x8FDB;&#x7A0B;&#x7684;&#x5185;&#x5B58;&#x6620;&#x5C04;&#x4FE1;&#x606F;</p>
<pre data-role="codeBlock" data-info="c" class="language-c"><span class="token keyword keyword-int">int</span> <span class="token function">xcd_maps_create</span><span class="token punctuation">(</span><span class="token class-name">xcd_maps_t</span> <span class="token operator">*</span><span class="token operator">*</span>self<span class="token punctuation">,</span> <span class="token class-name">pid_t</span> pid<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> 
    <span class="token function">snprintf</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;/proc/%d/maps&quot;</span><span class="token punctuation">,</span> pid<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token function">xcd_maps_parse_line</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token operator">&amp;</span>mi<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

</pre><h3 class="mume-header" id="xcd_process_record">xcd_process_record</h3>

<p>&#x2465; &#x8BB0;&#x5F55;&#x8FDB;&#x7A0B;&#x4FE1;&#x606F;<br>
&#x8FD9;&#x4E2A;&#x65B9;&#x9762;&#x91CC;&#x9762;&#x662F;&#x8BB0;&#x5F55;&#x8FDB;&#x7A0B;&#x91CC;&#x9762;&#x7684;&#x4E3B;&#x8981;&#x4FE1;&#x606F;</p>
<pre data-role="codeBlock" data-info="c" class="language-c"><span class="token keyword keyword-int">int</span> <span class="token function">xcd_process_record</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

 <span class="token comment">// &#x5FAA;&#x73AF;</span>
 <span class="token function">TAILQ_FOREACH</span><span class="token punctuation">(</span>thd<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span>self<span class="token operator">-&gt;</span>thds<span class="token punctuation">)</span><span class="token punctuation">,</span> link<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>thd<span class="token operator">-&gt;</span>t<span class="token punctuation">.</span>tid <span class="token operator">==</span> self<span class="token operator">-&gt;</span>crash_tid<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// &#x83B7;&#x53D6;&#x8FDB;&#x7A0B;&#x7684; id, &#x540D;&#x79F0; &#x548C; &#x7EBF;&#x7A0B; id</span>
            <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">xcd_thread_record_info</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>thd<span class="token operator">-&gt;</span>t<span class="token punctuation">)</span><span class="token punctuation">,</span> log_fd<span class="token punctuation">,</span> self<span class="token operator">-&gt;</span>pname<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> r<span class="token punctuation">;</span>
            <span class="token comment">// &#x83B7;&#x53D6; signal &#x4FE1;&#x53F7;&#x4FE1;&#x606F;</span>
            <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">xcd_process_record_signal_info</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> log_fd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> r<span class="token punctuation">;</span>
            <span class="token comment">// &#x83B7;&#x53D6; Abort message</span>
            <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">xcd_process_record_abort_message</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> log_fd<span class="token punctuation">,</span> api_level<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> r<span class="token punctuation">;</span>
            <span class="token comment">// &#x83B7;&#x53D6;&#x5BC4;&#x5B58;&#x5668;&#x4FE1;&#x606F;</span>
            <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">xcd_thread_record_regs</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>thd<span class="token operator">-&gt;</span>t<span class="token punctuation">)</span><span class="token punctuation">,</span> log_fd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> r<span class="token punctuation">;</span>
            <span class="token comment">// &#x83B7;&#x53D6;&#x7EBF;&#x7A0B;&#x6BCF;&#x5E27;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x91CC;&#x9762;&#x5305;&#x542B; Elf &#x7684;&#x89E3;&#x6790;</span>
            <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> <span class="token function">xcd_thread_load_frames</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>thd<span class="token operator">-&gt;</span>t<span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token operator">-&gt;</span>maps<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// &#x83B7;&#x53D6; backtrace &#x5806;&#x6808;&#x4FE1;&#x606F;</span>
                <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">xcd_thread_record_backtrace</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>thd<span class="token operator">-&gt;</span>t<span class="token punctuation">)</span><span class="token punctuation">,</span> log_fd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> r<span class="token punctuation">;</span>
                <span class="token comment">// &#x83B7;&#x53D6; so &#x7684; build id&#xFF0C; &#x65F6;&#x95F4;</span>
                <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">xcd_thread_record_buildid</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>thd<span class="token operator">-&gt;</span>t<span class="token punctuation">)</span><span class="token punctuation">,</span> log_fd<span class="token punctuation">,</span> dump_elf_hash<span class="token punctuation">,</span> <span class="token function">xcc_util_signal_has_si_addr</span><span class="token punctuation">(</span>self<span class="token operator">-&gt;</span>si<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token class-name">uintptr_t</span><span class="token punctuation">)</span>self<span class="token operator">-&gt;</span>si<span class="token operator">-&gt;</span>si_addr <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> r<span class="token punctuation">;</span>
                <span class="token comment">// &#x83B7;&#x53D6; stack &#x4FE1;&#x606F;</span>
                <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">xcd_thread_record_stack</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>thd<span class="token operator">-&gt;</span>t<span class="token punctuation">)</span><span class="token punctuation">,</span> log_fd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> r<span class="token punctuation">;</span>
                <span class="token comment">// &#x83B7;&#x53D6;&#x5185;&#x5B58;&#x4FE1;&#x606F;</span>
                <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">xcd_thread_record_memory</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>thd<span class="token operator">-&gt;</span>t<span class="token punctuation">)</span><span class="token punctuation">,</span> log_fd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> r<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// &#x5185;&#x5B58; map</span>
            <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>dump_map<span class="token punctuation">)</span> <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">xcd_maps_record</span><span class="token punctuation">(</span>self<span class="token operator">-&gt;</span>maps<span class="token punctuation">,</span> log_fd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> r<span class="token punctuation">;</span>
            <span class="token comment">// &#x7CFB;&#x7EDF; logcat &#x4FE1;&#x606F;</span>
            <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">xcc_util_record_logcat</span><span class="token punctuation">(</span>log_fd<span class="token punctuation">,</span> self<span class="token operator">-&gt;</span>pid<span class="token punctuation">,</span> api_level<span class="token punctuation">,</span> logcat_system_lines<span class="token punctuation">,</span> logcat_events_lines<span class="token punctuation">,</span> logcat_main_lines<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> r<span class="token punctuation">;</span>
            <span class="token comment">// &#x6587;&#x4EF6;&#x53E5;&#x67C4; fd</span>
            <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>dump_fds<span class="token punctuation">)</span> <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">xcc_util_record_fds</span><span class="token punctuation">(</span>log_fd<span class="token punctuation">,</span> self<span class="token operator">-&gt;</span>pid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> r<span class="token punctuation">;</span>
            <span class="token comment">// &#x7F51;&#x7EDC;&#x4FE1;&#x606F;</span>
            <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>dump_network_info<span class="token punctuation">)</span> <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">xcc_util_record_network_info</span><span class="token punctuation">(</span>log_fd<span class="token punctuation">,</span> self<span class="token operator">-&gt;</span>pid<span class="token punctuation">,</span> api_level<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> r<span class="token punctuation">;</span>
            <span class="token comment">// &#x5185;&#x5B58;&#x4FE1;&#x606F;</span>
            <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">xcc_meminfo_record</span><span class="token punctuation">(</span>log_fd<span class="token punctuation">,</span> self<span class="token operator">-&gt;</span>pid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> r<span class="token punctuation">;</span>

            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</pre><ul>
<li><strong>&#x83B7;&#x53D6;&#x8FDB;&#x7A0B;&#x7684; id, &#x540D;&#x79F0; &#x548C; &#x7EBF;&#x7A0B; id</strong></li>
</ul>
<pre data-role="codeBlock" data-info class="language-"><code>pid: 20501, tid: 20501, name: xcrash.sample  &gt;&gt;&gt; xcrash.sample &lt;&lt;&lt;
</code></pre><ul>
<li><strong>&#x83B7;&#x53D6; signal &#x4FE1;&#x53F7;&#x4FE1;&#x606F;</strong></li>
</ul>
<pre data-role="codeBlock" data-info class="language-"><code>signal 11 (SIGSEGV), code 1 (SEGV_MAPERR), fault addr 0x0
</code></pre><ul>
<li><strong>&#x83B7;&#x53D6; Abort message</strong></li>
</ul>
<pre data-role="codeBlock" data-info class="language-"><code>Abort message: &apos;Check failed: key_value != nullptr compiler-filter not found in oat header&apos;
</code></pre><ul>
<li><strong>&#x83B7;&#x53D6;&#x5BC4;&#x5B58;&#x5668;&#x4FE1;&#x606F;</strong></li>
</ul>
<pre data-role="codeBlock" data-info class="language-"><code>r0  00000000  r1  00003d49  r2  00000006  r3  a2787e90
r4  a2787ea4  r5  a2787e88  r6  00003d3f  r7  0000016b
r8  a2787ea0  r9  a2787e90  r10 a2787ec0  r11 a2787eb0
ip  00003d49  sp  a2787e60  lr  b29afc33  pc  b29afc46
</code></pre><ul>
<li><strong>&#x83B7;&#x53D6; backtrace &#x5806;&#x6808;&#x4FE1;&#x606F;</strong></li>
</ul>
<pre data-role="codeBlock" data-info class="language-"><code>backtrace:
    #00 pc 0005ec46  /apex/com.android.runtime/lib/bionic/libc.so (abort+165)
    #01 pc 0037ced1  /apex/com.android.runtime/lib/libart.so (_ZN3art7Runtime5AbortEPKc+1600)
    #02 pc 0000857d  /system/lib/libbase.so (_ZN7android4base10LogMessageD2Ev+412)
    #03 pc 00329937  /apex/com.android.runtime/lib/libart.so (_ZNK3art9OatHeader17GetCompilerFilterEv+170)
    #04 pc 0032f241  /apex/com.android.runtime/lib/libart.so (_ZNK3art7OatFile17GetCompilerFilterEv+20)
    #05 pc 003377e1  /apex/com.android.runtime/lib/libart.so (_ZN3art14OatFileManager14DumpForSigQuitERNSt3__113basic_ostreamIcNS1_11char_traitsIcEEEE+248)
    #06 pc 00387035  /apex/com.android.runtime/lib/libart.so (_ZN3art7Runtime14DumpForSigQuitERNSt3__113basic_ostreamIcNS1_11char_traitsIcEEEE+68)
    #07 pc 00396227  /apex/com.android.runtime/lib/libart.so (_ZN3art13SignalCatcher13HandleSigQuitEv+1026)
    #08 pc 0039567f  /apex/com.android.runtime/lib/libart.so (_ZN3art13SignalCatcher3RunEPv+246)
    #09 pc 000a6077  /apex/com.android.runtime/lib/bionic/libc.so (_ZL15__pthread_startPv+20)
    #10 pc 00060131  /apex/com.android.runtime/lib/bionic/libc.so (__start_thread+30)
</code></pre><ul>
<li><strong>&#x83B7;&#x53D6; so &#x7684; build id&#x3001;md5 &#x548C;&#x65F6;&#x95F4;</strong></li>
</ul>
<pre data-role="codeBlock" data-info class="language-"><code>build id:
    /apex/com.android.runtime/lib/bionic/libc.so (BuildId: 00be8c4fc1e3ff439b7de04fef5dc81b. FileSize: 987864. LastModified: 2009-01-01T07:00:00.000+0700. MD5: e8f59e3f6da4b10a0c60dd960c2db4a6)
    /apex/com.android.runtime/lib/libart.so (BuildId: 02ff9b2d73bf74036eb619d1893bf752. FileSize: 6020200. LastModified: 2009-01-01T07:00:00.000+0700. MD5: 50b1a5e915af28db70cd41298ff7b61e)
    /system/lib/libbase.so (BuildId: d61356f7fd581149bcf4b8d8caeb7d8a. FileSize: 63180. LastModified: 2009-01-01T07:00:00.000+0700. MD5: de03c2d4fc8f0659516ae0cbf4686db0)
</code></pre><ul>
<li><strong>&#x83B7;&#x53D6; stack &#x4FE1;&#x606F;</strong></li>
</ul>
<pre data-role="codeBlock" data-info class="language-"><code>stack:
         a2787e20  00000002
         a2787e24  b2a07260  [anon:.bss]
         a2787e28  00000000
         a2787e2c  6ee08ad0  [anon:libc_malloc]
         a2787e30  b06e1217  /apex/com.android.runtime/lib/libart.so
         a2787e34  09b33a2f  /system/bin/app_process32 (sigprocmask64+70)
         a2787e38  00000000
         a2787e3c  b2a07260  [anon:.bss]
         a2787e40  b47037a4  [anon:libc_malloc]
         a2787e44  345acf15  [anon:dalvik-main space (region space)]
         a2787e48  a2787f70
         a2787e4c  a2787e88
         a2787e50  a2787f70
         a2787e54  a2787e88
         a2787e58  00003d3f
         a2787e5c  b44b8190  [anon:.bss]
    #00  a2787e60  a2787ed0
         a2787e64  a2787ee0
</code></pre><ul>
<li><strong>&#x83B7;&#x53D6;&#x5185;&#x5B58;&#x4FE1;&#x606F;</strong></li>
</ul>
<pre data-role="codeBlock" data-info class="language-"><code>memory near r1:
    00003d28 -------- -------- -------- --------  ................
    00003d38 -------- -------- -------- --------  ................
    00003d48 -------- -------- -------- --------  ................
    00003d58 -------- -------- -------- --------  ................
    00003d68 -------- -------- -------- --------  ................
    00003d78 -------- -------- -------- --------  ................
    00003d88 -------- -------- -------- --------  ................
    00003d98 -------- -------- -------- --------  ................
    00003da8 -------- -------- -------- --------  ................
    00003db8 -------- -------- -------- --------  ................
</code></pre><ul>
<li><strong>&#x5185;&#x5B58;&#x6620;&#x5C04; map</strong></li>
</ul>
<pre data-role="codeBlock" data-info class="language-"><code>memory map:
    00580000-005c0000 rw-        0    40000 [anon:v8]
    005ed000-00dee000 rw-        0   801000 [anon:libc_malloc]
    00dee000-00def000 ---        0     1000 
    00def000-00df0000 ---        0     1000 
    00df0000-00ef6000 rw-        0   106000 
    00ef6000-00ef8000 ---        0     2000 
    00ef8000-00ef9000 ---        0     1000 
    00ef9000-00fff000 rw-        0   106000 
    00fff000-01000000 ---        0     1000 
    01000000-01001000 ---        0     1000 [anon:partition_alloc]
</code></pre><ul>
<li><strong>&#x7CFB;&#x7EDF; logcat &#x4FE1;&#x606F;</strong></li>
</ul>
<pre data-role="codeBlock" data-info class="language-"><code>logcat:
--------- tail end of log main (/system/bin/logcat -b main -d -v threadtime -t 200 --pid 6875 *:D)
10-11 14:52:04.026  6875  6875 I xcrash.sample: Not late-enabling -Xcheck:jni (already on)
10-11 14:52:04.060  6875  6875 E xcrash.sample: Unknown bits set in runtime_flags: 0x8000
10-11 14:52:04.065  6875  6875 W xcrash.sample: Unexpected CPU variant for X86 using defaults: x86_64
10-11 14:52:04.613  6875  6875 D xcrash_sample: xCrash SDK init: start
10-11 14:52:04.622  6875  6875 D xcrash_sample: xCrash SDK init: end
10-11 14:52:04.676  6875  6906 D libEGL  : Emulator has host GPU support, qemu.gles is set to 1.
</code></pre><ul>
<li><strong>&#x6587;&#x4EF6;&#x53E5;&#x67C4; fd</strong></li>
</ul>
<pre data-role="codeBlock" data-info class="language-"><code>open files:
    fd 0: /dev/null
    fd 1: /dev/null
    fd 2: /dev/null
    fd 3: socket:[95117]
    fd 4: /sys/kernel/debug/tracing/trace_marker
    fd 5: /dev/null
    fd 6: /dev/null
    fd 7: /dev/null
    fd 8: /dev/binder
    fd 9: /apex/com.android.runtime/javalib/core-oj.jar
    fd 10: /apex/com.android.runtime/javalib/core-libart.jar
</code></pre><ul>
<li><strong>&#x7F51;&#x7EDC;&#x4FE1;&#x606F;</strong></li>
</ul>
<pre data-role="codeBlock" data-info class="language-"><code>network info:
 TCP over IPv4 (From: /proc/PID/net/tcp)
  sl  local_address rem_address   st tx_queue rx_queue tr tm-&gt;when retrnsmt   uid  timeout inode
  0: 0100007F:CF99 00000000:0000 0A 00000000:00000000 00:00000000 00000000 10133        0 342943 1 00000000 100 0 0 10 0
  1: F326C70A:8B28 5E0AFB8E:01BB 01 00000000:00000000 00:00000000 00000000 10127        0 385678 1 00000000 27 4 29 10 -1
  2: F326C70A:9F62 9DC87D4A:01BB 01 00000000:00000000 00:00000000 00000000 10127        0 384590 1 00000000 25 4 19 10 -1
  3: F326C70A:9F52 9DC87D4A:01BB 01 00000000:00000000 00:00000000 00000000 10127        0 377105 1 00000000 26 4 24 10 -1
</code></pre><ul>
<li><strong>&#x5185;&#x5B58;&#x4FE1;&#x606F;</strong></li>
</ul>
<pre data-role="codeBlock" data-info class="language-"><code>memory info:
 System Summary (From: /proc/meminfo)
  MemTotal:        1846008 kB
  MemFree:           39444 kB
  MemAvailable:     468560 kB
  Buffers:           13184 kB
  Cached:           555712 kB
  SwapCached:        46180 kB
  Active:           525916 kB
  Inactive:         534600 kB
  Active(anon):     278644 kB
  Inactive(anon):   283012 kB
  Active(file):     247272 kB
  Inactive(file):   251588 kB
  Unevictable:       62468 kB
  Mlocked:           62468 kB
</code></pre><h1 class="mume-header" id="3-anr-%E7%9A%84%E6%8D%95%E8%8E%B7">3. ANR &#x7684;&#x6355;&#x83B7;</h1>

<p>ANR &#x7684;&#x6355;&#x83B7;&#x56E0;&#x4E3A; Android &#x7248;&#x672C;&#x7684;&#x9650;&#x5236;&#xFF0C;&#x5728;&#x4F4E;&#x4E8E; 21 &#x4E00;&#x4E0B;&#x662F;&#x5728; AnrHandler &#x4E2D;&#xFF0C;&#x901A;&#x8FC7;&#x76D1;&#x542C; /data/anr/ &#x8DEF;&#x5F84;&#x4E0B;&#x7684;&#x6587;&#x4EF6;&#x53D8;&#x5316;&#x6765;&#x5B9E;&#x73B0;&#x7684;&#x3002;</p>
<pre data-role="codeBlock" data-info="java" class="language-java"><span class="token comment">// AnrHandler.java</span>
fileObserver <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">FileObserver</span><span class="token punctuation">(</span><span class="token string">&quot;/data/anr/&quot;</span><span class="token punctuation">,</span> CLOSE_WRITE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-void">void</span> <span class="token function">onEvent</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> event<span class="token punctuation">,</span> <span class="token class-name">String</span> path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-try">try</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>path <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">String</span> filepath <span class="token operator">=</span> <span class="token string">&quot;/data/anr/&quot;</span> <span class="token operator">+</span> path<span class="token punctuation">;</span>
                    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>filepath<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;trace&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token function">handleAnr</span><span class="token punctuation">(</span>filepath<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">XCrash</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;AnrHandler fileObserver onEvent failed&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-try">try</span> <span class="token punctuation">{</span>
        fileObserver<span class="token punctuation">.</span><span class="token function">startWatching</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
</pre><p>&#x5BF9;&#x4E8E;&#x5927;&#x4E8E;&#x53CA; 21 &#x7248;&#x672C;&#x4EE5;&#x4E0A;&#x7684;&#xFF0C;&#x5219;&#x5728; xc_trace.c &#x4E2D;</p>
<p><!--?xml version="1.0" encoding="UTF-8" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" contentscripttype="application/ecmascript" contentstyletype="text/css" height="289px" preserveAspectRatio="none" style="width:501px;height:289px;background:#FFFFFF;" version="1.1" viewBox="0 0 501 289" width="501px" zoomAndPan="magnify"><defs><filter height="300%" id="f1vrmo79ukgwbd" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="39" x2="39" y1="40.4883" y2="246.041"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="187.5" x2="187.5" y1="40.4883" y2="246.041"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="444" x2="444" y1="40.4883" y2="246.041"/><rect fill="#FEFECE" filter="url(#f1vrmo79ukgwbd)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="65" x="5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="12" y="25.5352">xc_jni.c</text><rect fill="#FEFECE" filter="url(#f1vrmo79ukgwbd)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="65" x="5" y="245.041"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="12" y="265.5762">xc_jni.c</text><rect fill="#FEFECE" filter="url(#f1vrmo79ukgwbd)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="82" x="144.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="151.5" y="25.5352">xc_trace.c</text><rect fill="#FEFECE" filter="url(#f1vrmo79ukgwbd)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="82" x="144.5" y="245.041"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="151.5" y="265.5762">xc_trace.c</text><rect fill="#FEFECE" filter="url(#f1vrmo79ukgwbd)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="89" x="398" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75" x="405" y="25.5352">xc_signal.c</text><rect fill="#FEFECE" filter="url(#f1vrmo79ukgwbd)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="89" x="398" y="245.041"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75" x="405" y="265.5762">xc_signal.c</text><polygon fill="#A80036" points="175.5,67.7988,185.5,71.7988,175.5,75.7988,179.5,71.7988" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="39.5" x2="181.5" y1="71.7988" y2="71.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="46.5" y="67.0566">xc_trace_init &#x521D;&#x59CB;&#x5316;</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="187.5" x2="229.5" y1="101.1094" y2="101.1094"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="229.5" x2="229.5" y1="101.1094" y2="114.1094"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="188.5" x2="229.5" y1="114.1094" y2="114.1094"/><polygon fill="#A80036" points="198.5,110.1094,188.5,114.1094,198.5,118.1094,194.5,114.1094" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196" x="194.5" y="96.3672">xc_trace_init_callback &#x8BBE;&#x7F6E;&#x56DE;&#x8C03;</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="187.5" x2="229.5" y1="143.4199" y2="143.4199"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="229.5" x2="229.5" y1="143.4199" y2="156.4199"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="188.5" x2="229.5" y1="156.4199" y2="156.4199"/><polygon fill="#A80036" points="198.5,152.4199,188.5,156.4199,198.5,160.4199,194.5,156.4199" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="194.5" y="138.6777">eventfd &#x521B;&#x5EFA;&#x6587;&#x4EF6;&#x53E5;&#x67C4;</text><polygon fill="#A80036" points="432.5,181.7305,442.5,185.7305,432.5,189.7305,436.5,185.7305" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="187.5" x2="438.5" y1="185.7305" y2="185.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233" x="194.5" y="180.9883">xcc_signal_trace_register &#x2460; &#x6CE8;&#x518C;&#x76D1;&#x542C;</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="187.5" x2="229.5" y1="215.041" y2="215.041"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="229.5" x2="229.5" y1="215.041" y2="228.041"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="188.5" x2="229.5" y1="228.041" y2="228.041"/><polygon fill="#A80036" points="198.5,224.041,188.5,228.041,198.5,232.041,194.5,228.041" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="194.5" y="210.2988">pthread_create &#x2461;&#x521B;&#x5EFA; dump &#x7EBF;&#x7A0B;</text><!--MD5=[a049c00dbf0dde2e119e8a9a2ffd13b4]
@startuml
xc_jni.c -> xc_trace.c:xc_trace_init 初始化
xc_trace.c - -> xc_trace.c:xc_trace_init_callback 设置回调
xc_trace.c - -> xc_trace.c:eventfd 创建文件句柄
xc_trace.c - -> xc_signal.c:xcc_signal_trace_register ① 注册监听
xc_trace.c - -> xc_trace.c:pthread_create ②创建 dump 线程

@enduml

PlantUML version 1.2021.12(Wed Oct 06 00:01:58 CST 2021)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: zh
Country: CN
--></g></svg></p><pre data-role="codeBlock" data-info="c" class="language-c"><span class="token keyword keyword-int">int</span> <span class="token function">xc_trace_init</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>xc_common_api_level <span class="token operator">&lt;</span> <span class="token number">21</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token comment">//init for JNI callback</span>
    <span class="token comment">// &#x8BBE;&#x7F6E;&#x56DE;&#x8C03;</span>
    <span class="token function">xc_trace_init_callback</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//create event FD</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&gt;</span> <span class="token punctuation">(</span>xc_trace_notifier <span class="token operator">=</span> <span class="token function">eventfd</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> EFD_CLOEXEC<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> XCC_ERRNO_SYS<span class="token punctuation">;</span>

    <span class="token comment">//register signal handler</span>
    <span class="token comment">// &#x6CE8;&#x518C;&#x76D1;&#x542C;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">xcc_signal_trace_register</span><span class="token punctuation">(</span>xc_trace_handler<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-goto">goto</span> err2<span class="token punctuation">;</span>

    <span class="token comment">//create thread for dump trace</span>
    <span class="token comment">// &#x2461;&#x521B;&#x5EFA; dump &#x7EBF;&#x7A0B;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>thd<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> xc_trace_dumper<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-goto">goto</span> err1<span class="token punctuation">;</span>

    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</pre><h3 class="mume-header" id="xcc_signal_trace_register">xcc_signal_trace_register</h3>

<p>xcc_signal_trace_register &#x2460; &#x6CE8;&#x518C;&#x76D1;&#x542C; &#x4F1A;&#x7528; xc_trace_handler &#x76D1;&#x542C;</p>
<p>&#x5982;&#x679C;&#x6709;&#x4FE1;&#x53F7;&#x8FC7;&#x6765;&#xFF0C;xc_trace_handler &#x91CC;&#x9762;&#x4F1A;&#x5199; xc_trace_notifier &#x7684;&#x503C;&#xFF0C;&#x901A;&#x77E5; dump &#x7EBF;&#x7A0B;&#x5F00;&#x59CB; dump</p>
<pre data-role="codeBlock" data-info="c" class="language-c"><span class="token keyword keyword-static">static</span> <span class="token keyword keyword-void">void</span> <span class="token function">xc_trace_handler</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> sig<span class="token punctuation">,</span> <span class="token class-name">siginfo_t</span> <span class="token operator">*</span>si<span class="token punctuation">,</span> <span class="token keyword keyword-void">void</span> <span class="token operator">*</span>uc<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">uint64_t</span> data<span class="token punctuation">;</span>
    
    <span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token punctuation">)</span>sig<span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token punctuation">)</span>si<span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token punctuation">)</span>uc<span class="token punctuation">;</span>

    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>xc_trace_notifier <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        data <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token function">XCC_UTIL_TEMP_FAILURE_RETRY</span><span class="token punctuation">(</span><span class="token function">write</span><span class="token punctuation">(</span>xc_trace_notifier<span class="token punctuation">,</span> <span class="token operator">&amp;</span>data<span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><h3 class="mume-header" id="xc_trace_dumper">xc_trace_dumper</h3>

<pre data-role="codeBlock" data-info="c" class="language-c"><span class="token keyword keyword-static">static</span> <span class="token keyword keyword-void">void</span> <span class="token operator">*</span><span class="token function">xc_trace_dumper</span><span class="token punctuation">(</span><span class="token keyword keyword-void">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

      <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//block here, waiting for sigquit</span>
        <span class="token comment">// &#x4E00;&#x76F4;&#x7B49;&#x7740; xc_trace_notifier &#x7684; &#x4FE1;&#x53F7;</span>
        <span class="token function">XCC_UTIL_TEMP_FAILURE_RETRY</span><span class="token punctuation">(</span><span class="token function">read</span><span class="token punctuation">(</span>xc_trace_notifier<span class="token punctuation">,</span> <span class="token operator">&amp;</span>data<span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token comment">// dump</span>
        <span class="token function">xc_trace_libart_runtime_dump</span><span class="token punctuation">(</span><span class="token operator">*</span>xc_trace_libart_runtime_instance<span class="token punctuation">,</span> xc_trace_libcpp_cerr<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
       <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</pre><h1 class="mume-header" id="4-%E6%80%BB%E7%BB%93">4. &#x603B;&#x7ED3;</h1>

<p>xCrash &#x6355;&#x83B7;&#x7684;&#x5D29;&#x6E83;&#x4FE1;&#x606F;&#x53EF;&#x4EE5;&#x5728;&#x7B2C;&#x4E8C;&#x6B21;&#x542F;&#x52A8;&#x7684;&#x65F6;&#x5019;&#x4E0A;&#x62A5;&#xFF0C;&#x6BD4;&#x8F83;&#x9002;&#x5408;&#x81EA;&#x5DF1;&#x642D;&#x5EFA;&#x7684;&#x5D29;&#x6E83;&#x4E0A;&#x62A5;&#x7CFB;&#x7EDF;&#x3002;&#x5E02;&#x573A;&#x4E0A;&#x73B0;&#x6709;&#x7684; &#x53CB;&#x76DF; &#x3001;Bugly &#x505A;&#x7684;&#x5F88;&#x597D;&#xFF0C;&#x4F46;&#x662F;&#x6709;&#x4E9B;&#x4EA7;&#x54C1;&#x6027;&#x8D28;&#x7684;&#x9700;&#x8981;&#xFF0C;&#x8981;&#x642D;&#x5EFA;&#x81EA;&#x5DF1;&#x7684;&#x5D29;&#x6E83;&#x4E0A;&#x62A5;&#xFF0C;xCrash &#x662F;&#x4E2A;&#x4E0D;&#x9519;&#x7684;&#x9009;&#x62E9;.</p>
<p>&#x53E6;&#x5916;&#xFF0C;xCrash &#x6D89;&#x53CA;&#x5F88;&#x591A;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x7684;&#x51FD;&#x6570;&#x5DF2;&#x7ECF;&#x5806;&#x6808;&#x56DE;&#x6EAF;&#x7684;&#x6280;&#x672F;&#xFF0C;&#x8FD9;&#x65B9;&#x6CD5;&#x77E5;&#x8BC6;&#x9700;&#x8981;&#x81EA;&#x5DF1;&#x540E;&#x7EED;&#x8865;&#x4E0A;&#x3002;</p>
<h1 class="mume-header" id="5-%E5%8F%82%E8%80%83">5. &#x53C2;&#x8003;</h1>

<ul>
<li><a href="https://mp.weixin.qq.com/s/g-WzYF3wWAljok1XjPoo7w?">Android &#x5E73;&#x53F0; Native &#x4EE3;&#x7801;&#x7684;&#x5D29;&#x6E83;&#x6355;&#x83B7;&#x673A;&#x5236;&#x53CA;&#x5B9E;&#x73B0;</a></li>
<li><a href="https://www.dalvik.work/2021/06/22/xcrash/">&#x5D29;&#x6E83;&#x65E5;&#x5FD7;&#x6536;&#x96C6;&#x5E93; xCrash &#x6D45;&#x6790;</a></li>
</ul>

      </div>
      
      
    
    
    
    
    
    
    
    
  
    </body></html>